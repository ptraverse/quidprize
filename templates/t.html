{% include "base.html" %}

       <script>
$(document).ready(function() {

    $("#ajax_ticket_activation_button").click(function() {
        var input_string = $("#id_activation_email").val();
        var raffle_id = $("#raffle_id").val();
        document.getElementById("id_loading_div").style.display = 'block';
        $.ajax({
            url : "/ticket_activation_json/"+raffle_id+"/",
            type : "POST",
            dataType: "json",
            data : {
                client_response : input_string,
                csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success : function(json) {
                    $('#id_response_div').html("");
                    $('#id_response_div').append('<div>');
                    if (json.status=='new')
                    {
                        $('#id_response_div').append('<pre>Your new shortlink is:</pre>');
                    }
                    else if (json.status=='existing')
                    {
                        $('#id_response_div').append('<pre>This email already has a shortlink:</pre>');
                    }
                    $('#id_response_div').append('<a href="http://bit.ly/'+json.hash+'">http://bt.ly/'+json.hash+'</a>');
                    if (json.status=='existing')
                    {
                        $('#id_response_div').append('<pre> Please login to view stats</pre>');
                    }
                    $('#id_response_div').append('</div>');
                },
                error : function(xhr,errmsg,err) {
                    alert(xhr.status + ": " + xhr.responseText);
                    $('#id_response_div').append(xhr.status + ": " + xhr.responseText);
                    $('#id_response_div').show();
                }
            });
        document.getElementById("id_activation_email").readOnly = true;
        document.getElementById("id_activation_email").style.background = '#dddddd';

        return false;
    });

    //defaultstart();

});

    var time_left = 3;
    var cinterval;
    var timestatus=1;

    function do_redirect()
    {
        window.location.href="{{ raffle.target_url }}";
    }

    function time_dec()
    {
        time_left--;
        document.getElementById('countdown').innerHTML = time_left;
        if(time_left == 0)
        {
            clearInterval(cinterval);
            do_redirect();
        }
    }

    function resumetime()
    {
        //time_left = 50;
        clearInterval(cinterval);
        cinterval = setInterval('time_dec()', 1000);
    }

    function defaultstart()
    {
        time_left = 3;
        clearInterval(cinterval);
        cinterval = setInterval('time_dec()', 1000);
    }

    function stopstarttime()
    {
        if(timestatus==1)
        {
            clearInterval(cinterval);
            //document.getElementById('stopbutton').value="Start";
            timestatus=0;
        }
        else
        {
            clearInterval(cinterval);
            cinterval = setInterval('time_dec()', 1000);
            //document.getElementById('stopbutton').value="Stop";
            timestatus=1;
        }
    }




        </script>
        <style type="text/css">
            .redirect_div {cursor:pointer;}
            .redirect_div:hover {background-color:#FAFAFA;}
        </style>

{% load widget_tweaks %}


{% if request.user.is_active %}
        {% include "menu.html" %}
{% else %}
        {% include "menu_alternate.html" %}
{% endif %}

{% if raffle %}
        {% include "raffle_div.html" %}

        <center>
        <br><br><br>
        <div class="redirect_div" id="redirect_div" style="margin-top: 40px; vertical-align: center; width: 210px; height: 32px; display: table-cell; vertical-align: middle;">
            <a class="content-subhead" onclick="stopstarttime();">Redirecting in <span id="countdown" style="font-size: larger;">3</span> ...
            <img id="playpause_img" src="/static/images/playpause.png" height="14" /></a>
        </div>
        </center>

        {% if ticketactivationform %}
        <form method="POST" action="" class="pure-form" style="text-align: center;padding-top:50px; " >{% csrf_token %}
            <fieldset class="pure-group">
                <center>
                <input type="hidden" id="raffle_id" value="{{ raffle.id }}" />
                <legend class="pure-legend" >Get your unique shortlink to win the above prize!</legend>
                {{ ticketactivationform.activation_email|attr:"class:pure-input-1-4"|attr:"placeholder:Email" }}
                </center>
            </fieldset>
            <button type="submit" class="pure-button pure-input-1-4 " id="ajax_ticket_activation_button" name="ajax_ticket_activation_button">
                Create Shortlink</button>
        </form>



{% endif %}

        <center>
        <div id="id_response_div" style="padding-top:20px;">

            <div id="id_loading_div" style="display: none; padding-top: 40px;">

                <img src="/static/images/1-0.gif" />
            </div>

        </div>
        </center>
{% endif %}

